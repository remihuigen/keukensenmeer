#!/bin/bash

# Run gitleaks to scan for secrets in staged files
# Using globally installed gitleaks via Homebrew

gitleaks git --config gitleaks.toml  --exit-code 1

# Check if gitleaks failed
if [ $? -ne 0 ]; then
    echo "‚ùå Gitleaks found secrets in staged files. Commit aborted."
    exit 1
fi

# Load environment variables from .env file
if [ -f .env ]; then
    export $(grep -v '^#' .env | xargs)
fi


# Check if DISABLE_PRE_COMMIT_LINT is not set to true
if [ "$DISABLE_PRE_COMMIT_LINT" != "true" ]; then
    pnpm lint:fix

    # Add fixed files back to the staging area
    git add .
fi